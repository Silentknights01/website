<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ورود - Silent Knights</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Berlin+Sans+FB:wght@300;400;500;600;700&family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ========== VARIABLES ========== */
        :root {
            --font-main: "Berlin Sans FB", system-ui, -apple-system, sans-serif;
            --font-mono: "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;

            /* Silent Knights Brand Colors */
            --color-primary: #E31E27;
            --color-primary-dark: #15151F;
            --color-secondary: #999A93;
            --color-accent: #E31E27;
            --color-neon: #F8F8F8;
            --color-bg: #030D33;
            --color-bg-secondary: #0A0A0F;
            --color-bg-card: #1A1A24;
            --color-gray: #999A93;
            --color-light: #F8F8F8;
            --color-text: #F8F8F8;
            --color-text-muted: #999A93;

            /* Effects */
            --radius: 16px;
            --radius-small: 8px;
            --shadow: 0 8px 32px rgba(227, 30, 39, 0.3);
            --shadow-neon: 0 0 20px rgba(227, 30, 39, 0.4);
            --shadow-glow: 0 0 40px rgba(227, 30, 39, 0.2);
            --transition-fast: 0.2s;
            --transition-normal: 0.3s;
            --transition-slow: 0.5s;
        }

        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-main);
            background: linear-gradient(135deg, var(--color-bg) 0%, var(--color-bg-secondary) 100%);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* ========== LOGIN CONTAINER ========== */
        .login-container {
            width: 100%;
            max-width: 420px;
            background: var(--color-bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.03);
            overflow: hidden;
            position: relative;
            transition: all var(--transition-normal) ease;
        }

        .login-container:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-neon);
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                var(--color-primary), 
                var(--color-secondary), 
                var(--color-secondary));
            transform: scaleX(0);
            transition: transform var(--transition-normal) ease;
        }

        .login-container:hover::before {
            transform: scaleX(1);
        }

        /* ========== HEADER ========== */
        .login-header {
            background: linear-gradient(135deg, rgba(227, 30, 39, 0.1), rgba(153, 154, 147, 0.05));
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(145deg, #E31E27, #15151F);
            box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.06), 0 0 18px rgba(227, 30, 39, 0.28);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--color-primary);
            font-weight: bold;
        }

        .brand-name {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-primary);
            text-shadow: 0 0 20px rgba(227, 30, 39, 0.5);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .brand-subtitle {
            color: var(--color-text-muted);
            font-size: 14px;
        }

        /* ========== FORM ========== */
        .login-form {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--color-text);
            font-weight: 500;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-small);
            color: var(--color-text);
            font-family: var(--font-main);
            font-size: 14px;
            transition: all var(--transition-fast) ease;
            outline: none;
        }

        .form-input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(227, 30, 39, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-input::placeholder {
            color: var(--color-text-muted);
        }

        .password-toggle {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            font-size: 14px;
            transition: color var(--transition-fast) ease;
        }

        .password-toggle:hover {
            color: var(--color-primary);
        }

        /* ========== REMEMBER & FORGOT ========== */
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--color-text-muted);
            cursor: pointer;
        }

        .remember-me input {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .forgot-password {
            color: var(--color-primary);
            text-decoration: none;
            transition: all var(--transition-fast) ease;
        }

        .forgot-password:hover {
            color: var(--color-neon);
            text-shadow: 0 0 8px var(--color-primary);
        }

        /* ========== BUTTONS ========== */
        .login-button {
            width: 100%;
            padding: 14px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-small);
            font-family: var(--font-main);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal) ease;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .login-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: left var(--transition-normal) ease;
        }

        .login-button:hover::before {
            left: 100%;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-neon);
            filter: brightness(1.1);
        }

        .login-button:active {
            transform: translateY(0);
        }

        .login-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .login-button:disabled:hover {
            transform: none;
            box-shadow: var(--shadow);
            filter: none;
        }

        /* ========== LOADING ========== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========== APPROVAL STATUS ========== */
        .approval-status {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-small);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-pending {
            border-color: #ffa502;
            color: #ffa502;
        }

        .status-approved {
            border-color: #2ed573;
            color: #2ed573;
        }

        .status-rejected {
            border-color: #ff4757;
            color: #ff4757;
        }

        /* ========== SEPARATOR ========== */
        .separator {
            text-align: center;
            margin: 25px 0;
            position: relative;
            color: var(--color-text-muted);
            font-size: 14px;
        }

        .separator::before {
            content: '';
            position: absolute;
            top: 50%;
            right: 0;
            width: 45%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--color-text-muted));
        }

        .separator::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 45%;
            height: 1px;
            background: linear-gradient(90deg, var(--color-text-muted), transparent);
        }

        /* ========== SOCIAL LOGIN ========== */
        .social-login {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 25px;
        }

        .social-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-small);
            color: var(--color-text);
            text-decoration: none;
            font-size: 14px;
            transition: all var(--transition-normal) ease;
            position: relative;
            overflow: hidden;
        }

        .social-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transition: left var(--transition-normal) ease;
        }

        .social-button:hover::before {
            left: 100%;
        }

        .social-button:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .social-icon {
            font-size: 16px;
        }

        /* ========== FOOTER ========== */
        .login-footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.03);
            background: rgba(255, 255, 255, 0.02);
            color: var(--color-text-muted);
            font-size: 14px;
        }

        .register-link {
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 500;
            margin-right: 5px;
            transition: all var(--transition-fast) ease;
        }

        .register-link:hover {
            color: var(--color-neon);
            text-shadow: 0 0 8px var(--color-primary);
        }

        /* ========== NOTIFICATION ========== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--color-bg-card);
            border: 1px solid var(--color-primary);
            border-radius: var(--radius-small);
            box-shadow: var(--shadow-neon);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform var(--transition-normal) ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-color: #ff4757;
        }

        .notification.success {
            border-color: var(--color-primary);
        }

        /* ========== BACKGROUND EFFECTS ========== */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .grid-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(rgba(227, 30, 39, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(227, 30, 39, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .floating-element {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(227, 30, 39, 0.1) 0%, transparent 70%);
            filter: blur(20px);
            animation: float 15s infinite linear;
        }

        .floating-element:nth-child(1) {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-element:nth-child(2) {
            top: 60%;
            right: 10%;
            animation-delay: -5s;
        }

        .floating-element:nth-child(3) {
            bottom: 20%;
            left: 20%;
            animation-delay: -10s;
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(20px, 20px) rotate(90deg);
            }
            50% {
                transform: translate(0, 40px) rotate(180deg);
            }
            75% {
                transform: translate(-20px, 20px) rotate(270deg);
            }
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 480px) {
            .login-container {
                max-width: 100%;
            }
            
            .login-form {
                padding: 20px;
            }
            
            .social-login {
                grid-template-columns: 1fr;
            }
            
            .form-options {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-effects">
        <div class="grid-pattern"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
    </div>

    <!-- Login Container -->
    <div class="login-container">
        <!-- Header -->
        <div class="login-header">
            <div class="logo">SK</div>
            <h1 class="brand-name">Silent Knights</h1>
            <p class="brand-subtitle">ورود به پنل مدیریت امنیت سایبری</p>
        </div>

        <!-- Form -->
        <form class="login-form" id="loginForm">
            <div class="form-group">
                <label class="form-label">نام کاربری یا ایمیل</label>
                <input type="text" class="form-input" id="identifier" placeholder="نام کاربری یا ایمیل خود را وارد کنید" required>
            </div>

            <div class="form-group">
                <label class="form-label">رمز عبور</label>
                <input type="password" class="form-input" id="password" placeholder="رمز عبور خود را وارد کنید" required>
                <button type="button" class="password-toggle" id="togglePassword">نمایش</button>
            </div>

            <div class="form-options">
                <label class="remember-me">
                    <input type="checkbox" id="rememberMe">
                    مرا به یاد داشته باش
                </label>
                <a href="#" class="forgot-password">رمز عبور را فراموش کرده‌اید؟</a>
            </div>

            <!-- وضعیت تأیید -->
            <div id="approvalStatus" class="approval-status" style="display: none;"></div>

            <button type="submit" class="login-button" id="loginButton">
                ورود به سیستم
            </button>

            <div class="separator">یا ورود با</div>

            <div class="social-login">
                <a href="#" class="social-button" onclick="loginWithGoogle()">
                    <span class="social-icon">🔐</span>
                    Google
                </a>
                <a href="#" class="social-button" onclick="loginWithGitHub()">
                    <span class="social-icon">💻</span>
                    GitHub
                </a>
            </div>
        </form>

        <!-- Footer -->
        <div class="login-footer">
            حساب کاربری ندارید؟ 
            <a href="Sign_Up.html" class="register-link">ثبت‌نام کنید</a>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // آدرس بک‌اند
        const API_BASE_URL = 'http://localhost:5000';
    
        // نمایش/مخفی کردن رمز عبور
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.textContent = type === 'password' ? 'نمایش' : 'مخفی';
        });
    
        // نمایش نوتیفیکیشن
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
    
        // مدیریت فرم ورود
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const identifier = document.getElementById('identifier').value;
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');

            // اعتبارسنجی اولیه
            if (!identifier.trim() || !password.trim()) {
                showNotification('لطفاً تمام فیلدهای ضروری را پر کنید', 'error');
                return;
            }

            // غیرفعال کردن دکمه ورود
            loginButton.disabled = true;
            loginButton.innerHTML = 'در حال بررسی... <span class="loading"></span>';

            try {
                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ identifier, password })
                });

                const data = await response.json();
                console.log('Login response:', data);

                // بررسی بر اساس کد وضعیت HTTP و status
                if (response.ok && data.status === 'success') {
                    // ✅ لاگین موفق
                    showNotification('ورود موفقیت‌آمیز بود! در حال انتقال...', 'success');
                    
                    // ذخیره اطلاعات کاربر
                    if (data.user) {
                        localStorage.setItem('user', JSON.stringify(data.user));
                        localStorage.setItem('token', 'user-authenticated');
                        console.log('User data saved:', data.user);
                    }
                    
                    // هدایت به داشبورد
                    setTimeout(() => {
                        window.location.href = 'Dashboard.html';
                    }, 1500);
                    
                } else {
                    // ❌ خطا در لاگین
                    showNotification(data.message || 'خطا در ورود به سیستم', 'error');
                    loginButton.disabled = false;
                    loginButton.innerHTML = 'ورود به سیستم';
                }

            } catch (error) {
                console.error('Login error:', error);
                showNotification('خطا در ارتباط با سرور', 'error');
                loginButton.disabled = false;
                loginButton.innerHTML = 'ورود به سیستم';
            }
        });
    
        // ورود با گوگل
        function loginWithGoogle() {
            showNotification('در حال انتقال به صفحه ورود گوگل...', 'success');
            
            setTimeout(() => {
                const isSuccess = Math.random() > 0.2;
                
                if (isSuccess) {
                    showNotification('ورود با گوگل موفقیت‌آمیز بود!', 'success');
                    setTimeout(() => {
                        window.location.href = 'http://localhost:5000/dashboard';
                    }, 2000);
                } else {
                    showNotification('ورود با گوگل ناموفق بود. لطفاً مجدداً تلاش کنید.', 'error');
                }
            }, 2000);
        }
    
        // ورود با گیت‌هاب
        function loginWithGitHub() {
            showNotification('در حال انتقال به صفحه ورود GitHub...', 'success');
            
            setTimeout(() => {
                const isSuccess = Math.random() > 0.2;
                
                if (isSuccess) {
                    showNotification('ورود با GitHub موفقیت‌آمیز بود!', 'success');
                    setTimeout(() => {
                        window.location.href = 'http://localhost:5000/dashboard';
                    }, 2000);
                } else {
                    showNotification('ورود با GitHub ناموفق بود. لطفاً مجدداً تلاش کنید.', 'error');
                }
            }, 2000);
        }
    
        // افکت تایپ برای زیرعنوان
        const subtitle = document.querySelector('.brand-subtitle');
        if (subtitle) {
            const originalText = subtitle.textContent;
            subtitle.textContent = '';
            
            let i = 0;
            function typeWriter() {
                if (i < originalText.length) {
                    subtitle.textContent += originalText.charAt(i);
                    i++;
                    setTimeout(typeWriter, 50);
                }
            }
            
            // شروع تایپ پس از بارگذاری صفحه
            setTimeout(typeWriter, 1000);
        }
    
        // تغییر رنگ دکمه‌ها هنگام hover
        const socialButtons = document.querySelectorAll('.social-button');
        socialButtons.forEach(button => {
            button.addEventListener('mouseenter', function() {
                this.style.background = 'rgba(227, 30, 39, 0.1)';
                this.style.borderColor = 'var(--color-primary)';
            });
            
            button.addEventListener('mouseleave', function() {
                this.style.background = 'rgba(255, 255, 255, 0.05)';
                this.style.borderColor = 'rgba(255, 255, 255, 0.1)';
            });
        });
    
        // بررسی وضعیت سرور هنگام بارگذاری صفحه
        window.addEventListener('load', async function() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/test`);
                const data = await response.json();
                console.log('Server status:', data);
            } catch (error) {
                console.warn('Server is not responding. Make sure backend is running.');
                showNotification('سرور در دسترس نیست. لطفاً از روشن بودن سرور اطمینان حاصل کنید.', 'error');
            }
        });
    
        // اعتبارسنجی فرم در زمان واقعی
        document.getElementById('identifier').addEventListener('input', validateForm);
        document.getElementById('password').addEventListener('input', validateForm);
    
        function validateForm() {
            const identifier = document.getElementById('identifier').value;
            const password = document.getElementById('password').value;
            const loginButton = document.getElementById('loginButton');
            
            // فعال/غیرفعال کردن دکمه بر اساس پر بودن فیلدها
            if (identifier.trim() && password.trim()) {
                loginButton.style.opacity = '1';
                loginButton.style.cursor = 'pointer';
            } else {
                loginButton.style.opacity = '0.7';
                loginButton.style.cursor = 'not-allowed';
            }
        }
    
        // فراموشی رمز عبور
        document.querySelector('.forgot-password').addEventListener('click', function(e) {
            e.preventDefault();
            showNotification('سیستم بازیابی رمز عبور به زودی فعال خواهد شد', 'success');
        });
    
        // Enter key برای submit فرم
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('loginForm').dispatchEvent(new Event('submit'));
            }
        });
    
        // مقداردهی اولیه اعتبارسنجی
        validateForm();
    </script>
</body>
</html>
